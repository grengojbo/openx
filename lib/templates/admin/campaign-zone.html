{*<!--

+---------------------------------------------------------------------------+
| OpenX v${RELEASE_MAJOR_MINOR}                                                                |
| ======${RELEASE_MAJOR_MINOR_DOUBLE_UNDERLINE}                                                                 |
|                                                                           |
| Copyright (c) 2003-2008 OpenX Limited                                     |
| For contact details, see: http://www.openx.org/                           |
|                                                                           |
| This program is free software; you can redistribute it and/or modify      |
| it under the terms of the GNU General Public License as published by      |
| the Free Software Foundation; either version 2 of the License, or         |
| (at your option) any later version.                                       |
|                                                                           |
| This program is distributed in the hope that it will be useful,           |
| but WITHOUT ANY WARRANTY; without even the implied warranty of            |
| MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             |
| GNU General Public License for more details.                              |
|                                                                           |
| You should have received a copy of the GNU General Public License         |
| along with this program; if not, write to the Free Software               |
| Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA |
+---------------------------------------------------------------------------+
$Id$

-->*}
<div id="campaign-zone">
  <input id="advertiser-id" type="hidden" value="{$advertiserId}" />
  <input id="campaign-id" type="hidden" value="{$campaignId}" />

  <div id="filters">
    <div id="filters-available">
      <div style="float: right">
        <label>
          Category
          <select class="category">
            <option value="10">Finance</option>
            <option value="20">Sports</option>
            <option value="30">Tourism</option>
          </select>
          <label>
            Search
            <input class="quick-search" type="text" title="Search zones and websites by name" />
          </label>
        </label>
      </div>
      <b>Available zones</b>
    </div>
    
    <div id="filters-linked">
      <div style="float: right">
        <label>
          Category
          <select class="category">
            <option value="10">Finance</option>
            <option value="20">Sports</option>
            <option value="30">Tourism</option>
          </select>
          <label>
            Search
            <input class="quick-search" type="text" title="Search zones and websites by name" />
          </label>
        </label>
      </div>
      <b>Linked zones</b>
    </div>
  </div>

  &nbsp;

  <div id="select-zones">
    <div id="available">
      <div class="zones-container">
        <table id="zones-available" class="zones">
          <tbody>
            <tr class="header">
              <th class="name" style="width: 20%"><label><input type="checkbox" class="checkbox select-all" /> Select / Unselect all</label></th>
              <th class="ctr">CTR</th>
              <th class="cr">CR</th>
              <th class="ecpm">eCPM</th>
              <th class="category">Category</th>
            </tr>
          </tbody>
          
          <tbody id="zones-available-rows">
            {include file=campaign-zone-zones.html
                     websites=$availableWebsites
                     checkboxPrefix=a}
          </tbody>
        </table>
      </div>    
    </div>
  
    <div id="linked">
      <div class="zones-container">
        <table id="zones-linked" class="zones">
          <tbody>
            <tr class="header">
              <th class="name" style="width: 20%"><label><input type="checkbox" class="checkbox select-all" /> Select / Unselect all</label></th>
              <th class="ctr">CTR</th>
              <th class="cr">CR</th>
              <th class="ecpm">eCPM</th>
              <th class="category">Category</th>
            </tr>
          </tbody>
          
          <tbody id="zones-linked-rows">
            {include file=campaign-zone-zones.html
                     websites=$linkedWebsites
                     checkboxPrefix=l}
          </tbody>
        </table>
      </div>    
    </div>
    
    <div id="linking-buttons">
      <input type="button" id="link-button" value="Link &raquo;" class="flat button" /><br />
      <input type="button" id="unlink-button" value="&laquo; Unlink" class="flat button" />
      
      <div style="margin-top: 3ex;">
        <span id="linking-indicator" class="ajax-loading hide">Linking...</span>
        <span id="error-indicator" class="ajax-error hide">Linking not successful, please try again</span>
      </div>
    </div>
  </div>

<!--   	
	<div id="select-zones" {if $runOfNetwork} class="hide"{/if}>
    <div style="float: right">
      <label>
        Search
        <input id="quick-search" type="text" title="Search zones and websites by name" />
       </label>
    </div>
    
		<form id="filters" class="filter-area">
			<label>
			  Showing
			  <select id="status" style="vertical-align: middle">
			    <option value="linked">Linked</option> 
			    <option value="notlinked">Not linked</option>
			    <option value="all">All</option>
			  </select>
			</label>
			
			<label>
			  zones from category
			  <select id="category" style="vertical-align: middle">
			    <option value="10">Finance</option>
			    <option value="20">Sports</option>
			    <option value="30">Tourism</option>
			  </select>
			</label>
		</form>
		
		<div id="filters-search" class="hide filter-area">
			Showing zones and websites containing
      <span id="search-phrase"></span> (<a id="show-filters" href="#">back to filters</a>)
		</div>
		
		<table id="zones">
		  <tbody>
			  <tr class="header">
			    <th class="name" style="width: 20%"><label><input type="checkbox" class="checkbox" id="all-zones" /> Select / Unselect all</label></th>
			    <th class="ctr">CTR</th>
			    <th class="cr">CR</th>
			    <th class="ecpm">eCPM</th>
			    <th class="category">Category</th>
			    <th class="description">Description</th>
			  </tr>
      </tbody>
      
      <tbody id="zones-rows">
        {include file=campaign-zone-zones.html
                 websites=$websites}
			</tbody>
		</table>
	</div>
	
	<input class="main-submit" value="Save changes" type="button" />
-->
 	
	<script type="text/javascript"><!--
{literal}
  $("#zones-available, #zones-linked").multicheckboxes({
    selectedClass: "to-link", 
    unselectedClass: "", 
    toSelectClass: "to-link", 
    toUselectClass: "",
    selectAllSelector: ".select-all"
  });
  
  $("#link-button").click(function() {
    sendLinkingRequest("link");
  });
  
  $("#unlink-button").click(function() {
    sendLinkingRequest("unlink");
  });
  
  function sendLinkingRequest(action) {
    var checkboxContainerSelector;
    if (action == "link") {
      checkboxContainerSelector = "#zones-available";
    } else {
      checkboxContainerSelector = "#zones-linked";
    }
  
    var checkedNames = $.map($(checkboxContainerSelector).find(":checked").not(".select-all"), function(val) {
      return val.name;
    });
    
    // Data from all filters
    var postData = { 
      "clientid": $("#advertiser-id").val(),
      "campaignid": $("#campaign-id").val(),
      "action": action,
      "ids": checkedNames
    };

    $.ajax({ 
      url: "campaign-zone-link.php",
      type: "GET",
      data: postData,
      complete: function() {
        $("#linking-indicator").hide();
      },
      success: function(data) {
        $data = $(data);
        $("#zones-available-rows").html($data.eq(0).find("tr"));
        $("#zones-linked-rows").html($data.eq(1).find("tr"));
      },
      error: function() {
        $("#error-indicator").show();
      } 
    });
    
    $("#error-indicator").hide();
    $("#linking-indicator").show();
  }

  /*
  $("#quick-search")
    .example("zone name, website name", { class_name: 'example-search'})
    .typeWatch({
      callback: function() {
        var value = $.trim(this.el.value);
        if (value.length > 0) {
          $("#filters").hide();
          $("#filters-search").find("#search-phrase").text(value).end().show();
          $.get("campaign-zone-zones.php", {
            clientid: $("#advertiser-id").val(),
            campaignid: $("#campaign-id").val(),
            text: $("#quick-search").val(),
          }, function(data) {
            $("#zones-rows").html(data);
            $("#campaign-zone #zones").updatestate();
          });
        } else {
          showFilters();
        }
      },
      wait: 300,
      captureLength: 1
    });
    
  $("#show-filters").click(function () {
    $("#quick-search").val("").triggerHandler("blur");
    showFilters();
  });
  
  $("#category, #status").change(showFilters);
  
  function showFilters() {
    $("#filters").show();
    $("#filters-search").hide();
    $.get("campaign-zone-zones.php", {
      clientid: $("#advertiser-id").val(),
      campaignid: $("#campaign-id").val(),
      status: $("#status").val(),
      category: $("#category").val()
    }, function(data) {
      $("#zones-rows").html(data);
      $("#campaign-zone #zones").updatestate();
    });
  }
    */
{/literal}  
  //--></script>

</div>