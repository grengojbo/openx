<?xml version="1.0"?>
<!DOCTYPE project SYSTEM          "../../includes/WebTest.dtd" [
  <!ENTITY config SYSTEM          "../../includes/config.xml">
  <!ENTITY checkForErrors SYSTEM  "../../modules/errors.xml">
  <!ENTITY deleteRawTrackers SYSTEM  "../../sql/sql_delete_raw_trackers.xml">
]
>

<!--
  Test tracker impressions
-->
<project name="Openads delivery - tjs.php" basedir="../.." default="main">
  <import file="../../includes/init.xml"/>
  <import file="${webtest.home}/lib/taskdef.xml"/>
  
  <property name="delivery_file" value="delivery_test/tjs.php"/>
  
  <target name="canoo-test">
    <!-- remove any tracker impressions and tracker variable values before the test -->
    &deleteRawTrackers;
    
    <testSpec name="Run Delivery">
      &config;
      <steps>
        <invoke description="Invoke a tracker image page" url="${delivery_file}" />
        &checkForErrors;
      </steps>
    </testSpec>
    
    <!-- test that impressions and variables were inserted into database -->
    <sqlunit testFile="${basedir}/usecases/sqlunit/data_raw_tracker.xml" haltOnFailure="true" debug="${debug}" />
  </target>
  
  <!-- clean cache, run a canoo test (without cache), and then run again (with cache) -->
  <target name="main" depends="test-cache" />

</project>