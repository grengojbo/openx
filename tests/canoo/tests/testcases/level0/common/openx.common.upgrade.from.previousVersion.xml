<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE project SYSTEM "../../../../dtd/WebTest.dtd"[
	<!ENTITY config  SYSTEM "../../modules/config_openx.xml">
	<!ENTITY connection  SYSTEM "../modules/connection.xml">
	<!ENTITY universal SYSTEM "../../level1/common/openx.common.installation.universal.xml">
	<!ENTITY welcome  SYSTEM "../../level1/common/openx.common.installation.welcome.xml">
	<!ENTITY terms  SYSTEM "../../level1/common/openx.common.installation.terms.xml">	
	<!ENTITY systemCheck  SYSTEM "../../level1/common/openx.common.installation.systemCheck.xml">
	<!ENTITY finished SYSTEM "../../level1/common/openx.common.installation.finished.xml">
	<!ENTITY plugins SYSTEM "../../level1/common/openx.common.installation.plugins.xml">
]>

<project name="OpenX upgrade from ${upgrade.version}" basedir="." default="main">
	<target name="main">
		<webtest name="Level0 - Setup test - upgrade test from ${upgrade.version}">
			&config;
			<steps>
				<!-- <invoke description="First page:  upgrade start" url="/" save="start_" /> -->
				<invoke url="/" />
					&welcome;
					<echo>${basedir}/../../../var</echo>
					<exec executable="chmod">
					    <arg value="-R"/>
					    <arg value="a+rw"/>
					    <arg value="${basedir}/../../../var"/>
				 	</exec>					
					
					<storeCookie name="oat" property="sessid" />
					&terms;
				
					<verifyText description="Check text on page:${upgrade.version} detected" text=" ${upgrade.version} detected" />
					<verifyText description="Check text on page: This version can be upgraded" text="This version can be upgraded" />
					<storeCookie name="oat" property="sessid" />
					&systemCheck;
				
					<setInputField name="username" value="${admin.login}"/>
					<setInputField name="password" value="${admin.pass}"/>
					<storeCookie name="oat" property="sessid" />
					<clickButton label="Continue »"/>
				
					<verifyText description="Check text on page: Database Settings" text="Database Settings" />
					<storeCookie name="oat" property="sessid" />
					<clickButton label="Continue »"/>
				
					<verifyText description="Check text on page: Congratulations, you have finished upgrading OpenX" text="Congratulations, you have finished upgrading OpenX" />	
					<storeCookie name="oat" property="sessid" />
					<clickButton label="Continue »"/>
				
					<verifyText description="Check text on page: Configuration checklist" text="Configuration checklist" />	
					<storeCookie name="oat" property="sessid" />
					<storeCookie name="PHPSESSID" property="sessid2" />
					
					<ifStep description="if ver > 2.6">
						<condition>
				        	<verifyProperty description="Check version no."
				        	    name="upgrade.version"
					       		propertyType="ant"
				        	    text="(^2\.[7-9].*)|(^[3-9]\..*)" regex="true" />
						</condition>
				        <then>				        	
							<setInputField name="previousPath" value="${basedir}/testcases/level0/${upgrade.version}/plug-ins"/>
			        	</then>
					</ifStep>					
					<clickButton label="Continue »"/>
				
					<storeCookie name="oat" property="sessid" />
					&plugins;					
					&finished;
			</steps>
		</webtest>
	</target>
</project>
