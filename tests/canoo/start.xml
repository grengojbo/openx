<?xml version="1.0"?>

<project name="delivery" basedir="." default="main">

  <import file="includes/init.xml"/>

  <property name="openads.path" value="${basedir}/../.."/>
  <property name="openads.url" value="${protocol}://${host}/${basepath}"/>
  <property name="openads.example_url" value="${openads.url}/delivery_test/example.php"/>
  <property name="uc" value="afr"/>

  <target name="www-admin">
    <ant antfile="usecases/loginTest.xml" />
  </target>

  <target name="init-delivery-db">
    <sql
        driver="com.mysql.jdbc.Driver"
        url="${sql.url}"
        userid="${sql.user}"
        password="${sql.password}"
        >
      <transaction src="sql/dropTables.sql" />
      <transaction src="sql/delivery.sql" />
      <classpath>
        <fileset dir="lib">
          <include name="**/*.jar"/>
        </fileset>
      </classpath>
      <transaction>
        UPDATE oa_banners SET url = "${openads.example_url}" WHERE url = "http://www.example.com"
      </transaction>
    </sql>
  </target>

  <target name="init-delivery-files">
    <copy file="php/example.php" todir="${openads.path}/www" />
  </target>

  <target name="init-delivery" depends="init-delivery-db, init-delivery-files" />

  <target name="delivery">
    <echo message="Base URL: ${openads.url}" />
    <ant antfile="usecases/delivery/ac.xml" />
    <ant antfile="usecases/delivery/afr.xml" />
    <ant antfile="usecases/delivery/ag.xml" />
    <ant antfile="usecases/delivery/ai.xml" />
    <ant antfile="usecases/delivery/ajs.xml" />
    <ant antfile="usecases/delivery/spc.xml" />
    <ant antfile="usecases/delivery/al.xml" />
    <ant antfile="usecases/delivery/alocal.xml" />
    <ant antfile="usecases/delivery/apu.xml" />
    <ant antfile="usecases/delivery/avw.xml" />
    <ant antfile="usecases/delivery/axmlrpc.xml" />
    <ant antfile="usecases/delivery/ck.xml" />
    <ant antfile="usecases/delivery/lg.xml" />
    <ant antfile="usecases/delivery/ti.xml" />
    <ant antfile="usecases/delivery/tjs.xml" />
  </target>

  <target name="test-one">
    <ant antfile="usecases/${uc}.xml" />
  </target>

  <target name="clean">
    <delete dir="target" />
  </target>

  <target name="main" depends="clean, init-delivery, delivery" />

</project>
