<?xml version="1.0" encoding="UTF-8"?>
<project name="openx" default="cruise">

	<macrodef name="svn-update">
		<attribute name="workDir"/>
		<sequential>
			<exec dir="@{workDir}" executable="svn" failonerror="true">
				<arg line="update --non-interactive"/>
			</exec>
		</sequential>
	</macrodef>

	<target name="init">
		<fail unless="label" message="Need to have 'label' defined"/>
	</target>

	<target name="clean">
		<delete file="build.log"/>
		<ant antfile="build.xml" dir="${basedir}" target="clean"/>
	</target>

	<target name="update">
		<svn-update workDir="${basedir}"/>
	</target>

	<target name="clone">
		<delete dir="target"/>
		<copy todir="target" overwrite="true">
			<fileset dir=".">
				<exclude name="target/**"/>
			</fileset>
		</copy>
	</target>

	<target name="build" depends="init, clone">
		<ant antfile="build.xml" dir="${basedir}/target" output="build.log" target="simpletest" />
	</target>

	<target name="test-canoo" depends="update, clean, clone">
    	<ant antfile="build.xml" dir="${basedir}/target" output="build.log" target="test-canoo-local" >
    		<property name="run.local" value="true"/>
    	</ant>
	</target>

	<target name="make-release">
		<ant antfile="build.xml" dir="${basedir}" output="build.log" target="release" />
	</target>

	<target name="cruise" depends="init, update, clean, build"/>

    <target name="release" depends="init, clean, update, make-release"/>

</project>
