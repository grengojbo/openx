{*<!--

+---------------------------------------------------------------------------+
| OpenX v${RELEASE_MAJOR_MINOR}                                                                |
| ======${RELEASE_MAJOR_MINOR_DOUBLE_UNDERLINE}                                                                 |
|                                                                           |
| Copyright (c) 2003-2009 OpenX Limited                                     |
| For contact details, see: http://www.openx.org/                           |
|                                                                           |
| This program is free software; you can redistribute it and/or modify      |
| it under the terms of the GNU General Public License as published by      |
| the Free Software Foundation; either version 2 of the License, or         |
| (at your option) any later version.                                       |
|                                                                           |
| This program is distributed in the hope that it will be useful,           |
| but WITHOUT ANY WARRANTY; without even the implied warranty of            |
| MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             |
| GNU General Public License for more details.                              |
|                                                                           |
| You should have received a copy of the GNU General Public License         |
| along with this program; if not, write to the Free Software               |
| Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA |
+---------------------------------------------------------------------------+
$Id$

-->*}

<div class="content">
  <div class="hide" id="market-cpm-callout" style="height: auto; width: 270px;">
      <p>The minimum CPM you provide for a specific campaign will 
      be the floor price OpenX Market uses for that campaign. 
      If the highest bid from OpenX Market exceeds the campaign's floor price, 
      OpenX Market will serve the ad and pay you the higher revenue. 
      Otherwise, your campaign's existing ad will be delivered.
      </p>
      <p>
          We recommend that you specify a CPM that represents 
          the effective CPM that you expect to get from your campaign.
      </p>
  </div>
  <div class='tableWrapper'>
      <div class='tableHeader'>
          <ul class='tableFilters'>
              <li>
                  <div class='label'>
                      Show:
                  </div>
  
                  <div class='dropDown'>
                      <span><span>
                          {if $campaignType == 'remnant'}
                              Remnant campaigns
                          {elseif $campaignType == 'contract'}
                              Contract campaigns
                          {else}
                              Remnant and contract campaigns
                          {/if}
                       </span></span>
  
                      <div class='panel'>
                          <div>
                              <ul>
                                  <li><a href='market-campaigns-settings.php?optInType=selected&amp;campaignType=remnant'>Remnant campaigns</a></li>
                                  <li><a href='market-campaigns-settings.php?optInType=selected&amp;campaignType=contract'>Contract campaigns</a></li>
                                  <li><a href='market-campaigns-settings.php?optInType=selected&amp;campaignType=all'>Remnant and contract campaigns</a></li>
                              </ul>
                          </div>
                      </div>
  
                      <div class='mask'></div>
                  </div>
                  <label class="search">Search <input id="search" type="text" name="search" value=""></label>
              </li>            
          </ul>
          {if !empty($topPager->links)}
          <ul class='tableFilters alignRight'>
              <li>
                <div class="pager">
                  <span class="controls">{$topPager->links}</span>
                </div>
              </li>
          </ul>
          {/if}
          
  
          <div class='clear'></div>
          <div class='corner left'></div>
          <div class='corner right'></div>
      </div>
      
      <table cellspacing='0' summary=''>
          <thead>
              <tr>
                  <th class='first toggleAll'>
                      <input type='checkbox'{if $firstView} checked="checked"{/if} id="toggleAll" />
                  </th>
                  <th class="name">
                      <label for="toggleAll">Campaign</label>
                  </th>
                  <th class="mkt-status">OpenX Market Settings</th>
                  <th class='cpm last'>
                      Minimum CPM that OpenX Market must beat
                      <span class="link" help="market-cpm-callout"><span class="icon icon-info">&nbsp;</span></span>
                      {literal}
                      <script type="text/javascript">
                      <!--
                       $(document).ready(function(){
                          //init help, apply offset for thirdLevelContent to get abs positioning right
                          $("#market-cpm-callout").help({
                              'parentXOffset' : 400,
                              'parentYOffset' : 400
                              }
                          );
                       });
                      //-->
                      </script>                    
                      {/literal}
                  </th>
              </tr>
          </thead>
  
  {if $from|@count}
          <tbody>
          {cycle name=bgcolor values="even,odd" assign=bgColor reset=1}
          {foreach key=campaignId item=campaign from=$from}
              {cycle name=bgcolor assign=bgColor}
              <tr class='{$bgColor}'>
                  <td class='toggleSelection'>
                      <input type='checkbox' name="toOptIn[]" value='{$campaignId}' 
                             id="c{$campaignId}"{if !isset($toOptIn[$campaignId]) || $toOptIn[$campaignId]} checked="checked"{/if} />
                  </td>
                  <td>
                    <span class="campaign-type-tag">{ox_campaign_type_tag type=$campaign.type}</span>
                    <label for="c{$campaignId}">{$campaign.campaignname|escape:html}</label>
                  </td>
                  
                  <td>
                     {if $campaign.optin_status}
                     <span class="market-opted-in">Opted in</span>
                     {else}
                     <span class="market-not-opted">Not opted in</span>
                     {/if} 
                  </td>                
                  <td>
                      $ <input type="text" class="cpm{if $minCpmsInvalid[$campaignId]} error{/if}" maxlength="{$maxValueLength}" 
                               name="cpm{$campaignId}" id="cpm{$campaignId}" value="{$campaign.minCpm|escape}"  /> USD
                      {if $minCpmsInvalid[$campaignId]}
                          <label class="error" for="cpm{$campaignId}">
                          {$minCpmsInvalid[$campaignId]}
                          </label>
                      {else}     
                        {if $campaign.minCpmCalculated}
                        <small>This is the campaign's calculated eCPM</small>
                        {elseif $campaign.minCpmSpecified}
                        <small>This is the campaign's specified CPM</small>
                        {/if}
                      {/if}
                  </td>
              </tr>
          {/foreach}
          </tbody>
          {if !empty($pager->links)}
              <tbody class="tableFooter">
                <tr>
                  <td  colspan="4">
                        <ul class='tableActions'>
                            <li>
                                <button class="left green-dot" type="submit" name="opt-in-submit">
                                    <span>&nbsp;</span>
                                    {if $optInSubmitLabel}$optInSubmitLabel{else}Opt in to OpenX Market{/if} 
                                </button>
                                <button class="left red-dot" type="submit" name="optout">
                                    <span>&nbsp;</span>
                                    {if $optOutSubmitLabel}$optoutSubmitLabel{else}Opt out of OpenX Market{/if} 
                                </button>
                            </li>
                        </ul>                  
                        <div class="pager">
                          <span class="summary">{$pager->summary}</span>
                          <span class="controls">{$pager->links}</span>
                        </div>
                  </td>
                </tr>
              </tbody>
          {/if}
          
  {else}
          <tbody>
              <tr class='odd'>
                  <td colspan='4'>&nbsp;</td>
              </tr>
              <tr class='even'>
                  <td colspan='4'>
                      <div class='tableMessage'>
                          <div class='panel'>
                              {capture assign=typeString}
                                {if $campaignType == 'remnant'}
                                    remnant
                                {elseif $campaignType == 'contract'}
                                    contract
                                {/if} 
                              {/capture}
                              
                              {if $campaignsOptedIn > 0}
                                  All of your {$typeString} campaigns have been opted in to OpenX Market.
                              {else}
                                  There are no {$typeString} campaigns to opt in to OpenX Market in your inventory.
                              {/if}
  
                              <div class='corner top-left'></div>
                              <div class='corner top-right'></div>
                              <div class='corner bottom-left'></div>
                              <div class='corner bottom-right'></div>
                          </div>
                      </div>
  
                      &nbsp;
                  </td>
              </tr>
              <tr class='odd'>
                  <td colspan='4'>&nbsp;</td>
              </tr>
          </tbody>
  {/if}
      </table>
  </div>
</div>

<div class='info-box'>
  <div class='panel'>
    <h3>Setting the campaign's floor price</h3>
    <p>
      OpenX Market must pay higher than the minimum CPM you set or your campaign's 
      original ad is served.
    </p>
    <p><em>Tip:</em> Set the minimum CPM close to your campaign's existing CPM to give yourself
      the best chance of maximizing your revenue uplift.
    </p>
    <img src="{$adminPluginWebPath}/oxMarket/images/campaign-cpm-info.gif"/>
    <p class="faq-link"><a href="http://www.openx.org/faq/market" target="_blank">Learn more about OpenX Market</a></p>    
    <div class='corner top-left'></div>
    <div class='corner top-right'></div>
    <div class='corner bottom-left'></div>
    <div class='corner bottom-right'></div>
  </div>
</div>
