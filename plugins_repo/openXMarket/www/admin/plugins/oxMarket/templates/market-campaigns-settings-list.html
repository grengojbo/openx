{*<!--

+---------------------------------------------------------------------------+
| OpenX v${RELEASE_MAJOR_MINOR}                                                                |
| ======${RELEASE_MAJOR_MINOR_DOUBLE_UNDERLINE}                                                                 |
|                                                                           |
| Copyright (c) 2003-2009 OpenX Limited                                     |
| For contact details, see: http://www.openx.org/                           |
|                                                                           |
| This program is free software; you can redistribute it and/or modify      |
| it under the terms of the GNU General Public License as published by      |
| the Free Software Foundation; either version 2 of the License, or         |
| (at your option) any later version.                                       |
|                                                                           |
| This program is distributed in the hope that it will be useful,           |
| but WITHOUT ANY WARRANTY; without even the implied warranty of            |
| MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             |
| GNU General Public License for more details.                              |
|                                                                           |
| You should have received a copy of the GNU General Public License         |
| along with this program; if not, write to the Free Software               |
| Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA |
+---------------------------------------------------------------------------+
$Id$

-->*}

<input type="hidden" name="p" value="{$page|escape}" /> 
<input type="hidden" name="campaignType" value="{$campaignType|escape}" />
<input type="hidden" name="order" value="{$order|escape}" />
<input type="hidden" name="desc" value="{$desc|escape}" />
{if !empty($pager->links)}
    <input type="hidden" name="allSelected" value="" id="allSelectedHidden" />
{/if}
 
{if !empty($topPager->links)}
  <div class="pager pager-top">
    <span class="controls">{$topPager->links}</span>
  </div>
{/if}
          
  
<table cellspacing='0' summary=''>
  <thead>
    <tr>
      <th class='first toggleAll'>
        <input type='checkbox' id="toggleAll" />
      </th>
      <th class="name{if $order == 'name'}{if $desc} sortDown{else} sortUp{/if}{/if}">
        <a href="market-campaigns-settings-list.php?order=name&amp;desc={if $order == 'name' && !$desc}1{else}0{/if}">Campaign</a>
      </th>
      
      <th class="mkt-status{if $order == 'optinstatus'}{if $desc} sortDown{else} sortUp{/if}{/if}">
        <a href="market-campaigns-settings-list.php?order=optinstatus&amp;desc={if $order == 'optinstatus' && !$desc}1{else}0{/if}">OpenX Market Settings</a>
      </th>
      <th class='cpm last'>
        Floor Price (CPM)&nbsp;<span class="link" help="market-cpm-callout"><span class="icon icon-info">&nbsp;</span></span>
        {literal}
          <script type="text/javascript">
          <!--
           $(document).ready(function(){
              //init help, apply offset for thirdLevelContent to get abs positioning right
              $("#market-cpm-callout").help({
                  'parentXOffset' : 400,
                  'parentYOffset' : 400
                  }
              );
           });
          //-->
          </script>                    
        {/literal}
      </th>
    </tr>
  </thead>
  
  {if !empty($pager->links)}
  <tbody id="selectAllContainer" class="hide">
    <tr class="header">
      <td colspan="6">
        <div id="selectAllCampaigns" class="selectAllInAccount hide">
          All <em>{$showingCount}</em> campaigns on this page selected. <a href="#">Select all <em>{$allMatchingCount}</em> matching campaigns from this account</a>
        </div>
        <div id="allSelected" class="selectAllInAccount hide">
          All <em>{$allMatchingCount}</em> matching campaigns from this account selected. <a href="#">Clear selection</a>
        </div>
      </td>
    </tr>
  </tbody>
  {/if}
  
  {if $campaigns|@count}
    <tbody>
      {cycle name=bgcolor values="even,odd" assign=bgColor reset=1}
      {foreach key=campaignId item=campaign from=$campaigns}
        {cycle name=bgcolor assign=bgColor}
        <tr class='{$bgColor}{if $toOptIn[$campaignId]} selected{/if}'>
          <td class='toggleSelection'>
            <input type='checkbox' name="toOptIn[]" value='{$campaignId}' 
                   id="c{$campaignId}"{if $toOptIn[$campaignId]} checked="checked"{/if} />
          </td>
          <td>
            <span class="campaign-type-tag">{ox_campaign_type_tag type=$campaign.type}</span>
            {* Output escaped by boldSearchPhrase *}
            <label for="c{$campaignId}">{boldSearchPhrase text=$campaign.campaignname search=$search}</label>
          </td>
          
          <td>
             {if $campaign.optin_status}
             <span class="market-opted-in">Opted in</span>
             {else}
             <span class="market-not-opted">Not opted in</span>
             {/if} 
          </td>                
          <td>
            <span style="float: left; padding-right: 3px">
              $ <input type="text" class="cpm{if $minCpmsInvalid[$campaignId]} error{/if}" maxlength="{$maxValueLength}" 
                       name="cpm{$campaignId}" id="cpm{$campaignId}" value="{$campaign.minCpm|escape}"  /> USD
            </span>
            {if $minCpmsInvalid[$campaignId]}
              <label class="error" for="cpm{$campaignId}">
              {$minCpmsInvalid[$campaignId]}
              </label>
            {else}     
              <small style="float: left"><span class="campaign-type-tag">
              {if $campaign.minCpmCalculated}
                {ox_campaign_type_tag type='ui-ecpm'}
              {elseif $campaign.minCpmSpecified}
                {ox_campaign_type_tag type='ui-cpm'}
              {/if}
              </span></small>
            {/if}
          </td>
        </tr>
      {/foreach}
    </tbody>
    <tbody class="tableFooter">
      <tr>
        <td  colspan="4">
          <ul class='tableActions'>
            <li>
              <button class="left green-dot" type="submit" name="optInSubmit">
                <span>&nbsp;</span>
                {if $optInSubmitLabel}$optInSubmitLabel{else}Opt in to OpenX Market{/if} 
              </button>
              <button class="left red-dot" type="submit" name="optOutSubmit">
                <span>&nbsp;</span>
                {if $optOutSubmitLabel}$optoutSubmitLabel{else}Opt out of OpenX Market{/if} 
              </button>
            </li>
          </ul>                  
          {if !empty($pager->links)}
          <div class="pager">
            <span class="summary">{$pager->summary}</span>
            <span class="controls">{$pager->links}</span>
          </div>
          {/if}
        </td>
      </tr>
    </tbody>
  {else}
    <tbody>
      <tr class='odd'>
        <td colspan='4'>&nbsp;</td>
      </tr>
      <tr class='even'>
        <td colspan='4'>
          <div class='tableMessage'>
            <div class='panel'>
              {capture assign=typeString}
                {if $campaignType == 'remnant'}
                    remnant
                {elseif $campaignType == 'contract'}
                    contract
                {/if} 
              {/capture}
              
              There are no {$typeString} campaigns to opt in to OpenX Market in your inventory.

              <div class='corner top-left'></div>
              <div class='corner top-right'></div>
              <div class='corner bottom-left'></div>
              <div class='corner bottom-right'></div>
            </div>
          </div>

          &nbsp;
        </td>
      </tr>
      <tr class='odd'>
        <td colspan='4'>&nbsp;</td>
      </tr>
    </tbody>
{/if}
</table>
